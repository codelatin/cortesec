<!-- finanzas/templates/finanzas/ingreso_form.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="content-wrapper">
  <div class="content-header">
    <div class="container-fluid">
      <div class="row mb-2">
        <div class="col-sm-6">
          <h1 class="m-0">{{ title }}</h1>
        </div>
        <div class="col-sm-6">
          <ol class="breadcrumb float-sm-right">
            <li class="breadcrumb-item"><a href="#">Inicio</a></li>
            <li class="breadcrumb-item"><a href="{% url 'finanzas:lista_ingresos' %}">Ingresos</a></li>
            <li class="breadcrumb-item active">{{ title }}</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <section class="content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-8">
          <div class="card card-primary">
            <div class="card-header">
              <h3 class="card-title">{{ title }}</h3>
            </div>
            <form method="post" enctype="multipart/form-data">
              {% csrf_token %}
              <!-- Mostrar errores generales del formulario -->
{% if form.errors %}
  <div class="alert alert-danger alert-dismissible fade show">
    <strong>¡Corrige los siguientes errores!</strong>
    <ul class="mb-0">
      {% for field in form %}
        {% for error in field.errors %}
          <li>{{ field.label }}: {{ error }}</li>
        {% endfor %}
      {% endfor %}
      {% for error in form.non_field_errors %}
        <li>{{ error }}</li>
      {% endfor %}
    </ul>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
{% endif %}
              <div class="card-body">
                {% for field in form %}
                  <div class="form-group">
                    {{ field.label_tag }}
                    {{ field }}
                    {% if field.help_text %}
                      <small class="form-text text-muted">{{ field.help_text }}</small>
                    {% endif %}
                    {% for error in field.errors %}
                      <div class="text-danger">{{ error }}</div>
                    {% endfor %}
                  </div>
                {% endfor %}
              </div>
              <div class="card-footer">
                <button type="submit" class="btn btn-primary">{{ submit_text }}</button>
                <a href="{% url 'finanzas:lista_ingresos' %}" class="btn btn-default">Cancelar</a>
              </div>
            </form>
          </div>
        </div>

        <!-- Panel de resumen (solo en recepción de pago) -->
        {% if ingreso %}
        <div class="col-md-4">
          <div class="card card-info">
            <div class="card-header">
              <h3 class="card-title">Resumen del Ingreso</h3>
            </div>
            <div class="card-body">
              <p><strong>Proyecto:</strong> {{ ingreso.proyecto.name }}</p>
              <p><strong>Código:</strong> {{ ingreso.proyecto.code }}</p>
              <p><strong>Concepto:</strong> {{ ingreso.concepto }}</p>
              <p><strong>Monto total:</strong> ${{ ingreso.monto_total|floatformat:2 }}</p>
              <p><strong>Monto recibido:</strong> ${{ ingreso.monto_recibido|floatformat:2 }}</p>
              <p><strong>Pendiente:</strong> 
                <span class="text-warning">${{ ingreso.monto_pendiente|floatformat:2 }}</span>
              </p>
              <p><strong>Estado:</strong> 
                {% if ingreso.estado == 'pendiente' %}
                  <span class="badge badge-warning">Pendiente</span>
                {% elif ingreso.estado == 'parcial' %}
                  <span class="badge badge-info">Parcial</span>
                {% elif ingreso.estado == 'recibido' %}
                  <span class="badge badge-success">Recibido</span>
                {% endif %}
              </p>
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </section>
</div>
{% endblock %}